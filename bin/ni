#!/usr/bin/env node

/*!
 * ni
 * Copyright(c) 2010 Madhusudhan Srinivasa <me@madhums.me>
 * MIT Licensed
 */

/*!
 * Module dependencies.
 */

var fs = require('fs');
var program = require('commander');
var mkdirp = require('mkdirp');
var pkg = require('../package.json');
var contents = require('../lib/');

program
  .version(pkg.version)
  .option('-d, --desc <desc>', 'A command to init node modules')
  .option('-e, --exec', 'Does it contain a executable')
  .option('-b, --bower', 'Should it contain bower.json?')

program
  .command('setup <repo>')
  .description('Setup node module with repo (username/repo)')
  .action(setup)

program
  .parse(process.argv);

/**
 * Setup
 *
 * @param {String} repo
 * @param {String} desc
 * @api private
 */

function setup (repo, desc) {
  var dir = __dirname + '/' + repo;

  mkdirp(dir, function (err) {
    if (err) {
      console.error(err);
    }

    process.chdir(dir);

    writeFile('.gitignore');
    writeFile('package.json');
    writeFile('README.md');
    writeFile('CHANGELOG.md');
    writeFile('lib/index.js');
  });
}

/**
 * writeFile
 *
 * @param {String} name
 * @api private
 */

function writeFile (name) {
  var dir = __dirname + '/' + name.split('/')[0];

  // If it is a file, simply write it
  if (!~name.indexOf('/')) {
    return writeContent(name, dir);
  }

  mkdirp(dir, function (err) {
    if (err) {
      console.error(err);
      return;
    }

    writeContent(name, dir + '/' + name[1]);
  });
}

/**
 * writeContent
 *
 * @param {String} name
 * @param {String} path
 * @api private
 */

function writeContent (name, path) {
  console.log(path);
  // fs.writeFile(path, contents[name]);
}
